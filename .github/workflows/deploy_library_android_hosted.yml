name: Deploy Package Github

on:
  workflow_call:
    inputs:
      version:
        description: "Version : "
        required: true
        default: ""
        type: string

jobs:
  deploy_library:
    name: Deploy Package
    runs-on: mk-mac-ios-01
    timeout-minutes: 100

    steps:
      - name: Validate Version Input
        run: |
          VERSION="${{ github.event.inputs.version }}"
          if [[ -z "$VERSION" ]]; then
            echo "Version input is required."
            exit 1
          fi
          if [[ ! $VERSION =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "Invalid version format. Use semantic versioning (e.g., 1.0.0)."
            exit 1
          fi

      - name: Print Inputs
        run: |
          echo "version": "${{ github.event.inputs.version }}"

      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "21"
          cache: "gradle"
          cache-dependency-path: |
            **/*.gradle*
            **/gradle-wrapper.properties

      - name: 🧑🏻‍💻 Make gradlew executable
        id: gradlew
        run: chmod +x ./gradlew

      - name: Set Custom Version
        run: echo "VERSION=${{ inputs.version }}" >> $GITHUB_ENV

      - name: Publish Package
        run: ./gradlew publish -PVERSION=$VERSION
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Verify Upload
        run: echo "Package published with version $VERSION"
